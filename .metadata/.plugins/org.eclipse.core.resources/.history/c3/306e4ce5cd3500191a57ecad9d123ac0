package nsp;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

//import javax.servlet.RequestDispatcher;

import com.login.UserDetail;

public class Login {
	
public static Connection getConnection() {
	try {
		Class.forName("com.mysql.cj.jdbc.Driver");
		//create the connection
		Connection con= DriverManager.getConnection("jdbc:mysql://localhost:3306/db26","root","admin");
		System.out.println("connected successfully");
		return con;
	} catch(ClassNotFoundException e)
	{
		e.printStackTrace();
		return null;
		
	}catch(SQLException e) {
		e.printStackTrace();
		return null;
			}
	
}
public static boolean validate(String username, String password,Connection con) {
	Boolean flag=false;
	try {
	String sql="select * from db26.User where usrname=? and pwd=?";
	PreparedStatement pstmst=con.prepareStatement(sql);
	pstmst.setString(1,username);
	pstmst.setString(2,password);
	ResultSet rs=pstmst.executeQuery();
	while(rs.next()) {
		flag=true;
		break;
	}
	return flag;
	}catch(SQLException e) {
		e.printStackTrace();
		return flag;
			}
	//return true;
}

	
/*
	if(result.next()) {
		Object response;
		response.sendRedirect("registration.jsp");
	}
	else {
		request.setAttribute("errmsg","username and password are incorrect");
				RequestDispatcher rd=request.getRequestDispatcher("/Login.java");
		rd.forward(request, reponse);
	}
	
}*/


public static  ArrayList<UserDetail> displayData(Connection con) {
	String sql="select * from db26.UserDetail";
	PreparedStatement pstmst;
	try {
	pstmst = con.prepareStatement(sql);
	ArrayList<UserDetail> al=new ArrayList<UserDetail>();
	ResultSet rs=pstmst.executeQuery();
	while(rs.next());{
		UserDetail detail=new UserDetail();
		detail.setName(rs.getString(1));
		detail.setGender(rs.getString(2));
		String[] arr= {rs.getString(3)};
		detail.setCities(arr);
		al.add(detail);
	}
	pstmst.close();
	rs.close();
	con.close();
	return al;
	}catch(SQLException e) {
		e.printStackTrace();
		return null;
	}
}
public static void insertData(UserDetail detail, Connection con) {
	// TODO Auto-generated method stub
	String city="";
	for(int i=0;i<detail.getCities().length;i++) {
		city=city+","+detail.getCities()[i];
	
	}
	
	String sql="inser into db26.UserDetail values(?,?,?)";
	PreparedStatement p;
	try {
		p=con.prepareStatement(sql);
		p.setString(1, detail.getName());
		p.setString(2, detail.getGender());
		p.setString(3, city);
		p.executeUpdate();
	}catch(SQLException e) {
		e.printStackTrace();
	}
	
		
		
	}
}



